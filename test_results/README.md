# è‡ªåŠ¨åŒ–æµ‹è¯•æ–‡æ¡£

## ç§‘å¹»å°è¯´ç”Ÿæˆæµ‹è¯•

### æµ‹è¯•è¯´æ˜

`test_scifi_novel.py` æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç«¯åˆ°ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œç”¨äºéªŒè¯ç³»ç»Ÿèƒ½å¦ç”Ÿæˆç¬¦åˆè´¨é‡æ ‡å‡†çš„ 4000 å­—ç§‘å¹»å°è¯´ã€‚

### æµ‹è¯•æµç¨‹

æµ‹è¯•ä¼šä¾æ¬¡æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

1. **åˆå§‹åŒ–ä¼šè¯**
   - åˆ›å»ºæµ‹è¯•ä¼šè¯
   - è®¾ç½®ç§‘å¹»ç±»å‹å’Œç›®æ ‡å­—æ•°

2. **é£æ ¼å®šä¹‰** (é˜¶æ®µ 1)
   - ç”Ÿæˆçº¦ 200 å­—çš„å†™ä½œé£æ ¼å®šä¹‰
   - åŒ…æ‹¬å™äº‹æ‰‹æ³•ã€è¯­è¨€ç‰¹è‰²ç­‰

3. **å¤§çº²ç”Ÿæˆ** (é˜¶æ®µ 2)
   - ç”Ÿæˆ 5 ç« èŠ‚çš„å°è¯´å¤§çº²
   - æ¯ç«  100-150 å­—æƒ…èŠ‚æè¿°

4. **äººç‰©è®¾å®š** (é˜¶æ®µ 3)
   - è®¾è®¡ 3-4 ä¸ªä¸»è¦äººç‰©
   - åŒ…æ‹¬èº«ä»½ã€æ€§æ ¼ã€èƒŒæ™¯

5. **ç« èŠ‚ç”Ÿæˆ** (é˜¶æ®µ 4)
   - é€ç« ç”Ÿæˆæ­£æ–‡å†…å®¹
   - æ¯ç« çº¦ 800 å­—
   - è‡ªåŠ¨è´¨é‡è¯„ä¼°

6. **æœ€ç»ˆè¯„ä¼°** (é˜¶æ®µ 5)
   - æ•´ä½“è´¨é‡è¯„åˆ†
   - éªŒæ”¶æ ‡å‡†æ£€æŸ¥

### éªŒæ”¶æ ‡å‡†

æµ‹è¯•é€šè¿‡éœ€æ»¡è¶³ä»¥ä¸‹å…¨éƒ¨æ¡ä»¶ï¼š

| æŒ‡æ ‡ | è¦æ±‚ |
|------|------|
| æ€»å­—æ•° | â‰¥ 4000 å­— |
| æ•´ä½“è´¨é‡è¯„åˆ† | â‰¥ 0.7 (æ»¡åˆ† 1.0) |
| å„ç»´åº¦è¯„åˆ† | æ‰€æœ‰ç»´åº¦ â‰¥ 0.6 |

è´¨é‡è¯„ä¼°ç»´åº¦åŒ…æ‹¬ï¼š
- **Coherence (è¿è´¯æ€§)**: 25%
- **Creativity (åˆ›æ–°æ€§)**: 20%
- **Quality (å†™ä½œè´¨é‡)**: 20%
- **Consistency (ä¸€è‡´æ€§)**: 20%
- **Plot Progression (æƒ…èŠ‚å‘å±•)**: 15%

### è¿è¡Œæµ‹è¯•

```bash
# 1. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# 2. è¿è¡Œæµ‹è¯•
python scripts/test_scifi_novel.py

# 3. æŸ¥çœ‹å®æ—¶è¾“å‡ºï¼ˆå¦‚æœéœ€è¦ï¼‰
python scripts/test_scifi_novel.py 2>&1 | tee test_output.log
```

### æµ‹è¯•è¾“å‡º

æµ‹è¯•å®Œæˆåä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

#### 1. å°è¯´æ–‡æœ¬æ–‡ä»¶
ä½ç½®ï¼š`test_results/scifi_novel_[æ—¶é—´æˆ³].txt`

åŒ…å«å†…å®¹ï¼š
- é£æ ¼å®šä¹‰
- å°è¯´å¤§çº²
- äººç‰©è®¾å®š
- æ‰€æœ‰ç« èŠ‚æ­£æ–‡

#### 2. æµ‹è¯•æŠ¥å‘Š
ä½ç½®ï¼š`test_results/test_report_[æ—¶é—´æˆ³].json`

åŒ…å«å†…å®¹ï¼š
```json
{
  "session_id": "test_scifi_xxx",
  "total_word_count": 4200,
  "chapter_count": 5,
  "passed": true,
  "stages": {
    "style": {"status": "success", "word_count": 314},
    "outline": {"status": "success", "word_count": 650},
    ...
  },
  "quality_scores": {
    "chapter_1": {"score": 0.85, ...},
    "final": {"score": 0.78, ...}
  },
  "acceptance_criteria": {
    "passed": ["âœ“ å­—æ•°è¾¾æ ‡: 4200 â‰¥ 4000", ...],
    "failed": []
  }
}
```

### é¢„æœŸæ‰§è¡Œæ—¶é—´

- **æ­£å¸¸æƒ…å†µ**: 5-8 åˆ†é’Ÿ
- **æ…¢é€Ÿç½‘ç»œ**: 10-15 åˆ†é’Ÿ

æ—¶é—´ä¸»è¦èŠ±è´¹åœ¨ï¼š
- LLM API è°ƒç”¨ (æ¯æ¬¡ 2-10 ç§’)
- è´¨é‡è¯„ä¼° (æ¯æ¬¡ 2-5 ç§’)
- å‘é‡å­˜å‚¨æ“ä½œ (æ¯æ¬¡ < 1 ç§’)

### æµ‹è¯•æ—¥å¿—ç¤ºä¾‹

```
================================================================================
ğŸ“š ç§‘å¹»å°è¯´è‡ªåŠ¨åŒ–æµ‹è¯•å¼€å§‹
================================================================================
ä¼šè¯ ID: test_scifi_1769186237
ç›®æ ‡å­—æ•°: 4000 å­—
æœ€ä½è´¨é‡åˆ†: 0.7
================================================================================
âœ“ ä¼šè¯åˆ›å»ºæˆåŠŸ

================================================================================
ğŸ“ é˜¶æ®µ 1: ç”Ÿæˆé£æ ¼å®šä¹‰
================================================================================
âœ“ é£æ ¼å®šä¹‰ç”Ÿæˆå®Œæˆ
å†…å®¹é¢„è§ˆ: é£æ ¼å®šä¹‰ï¼šç†æ€§å†·é™ä¸å®å¤§å²è¯—äº¤ç»‡çš„ç¡¬æ ¸å¤ªç©ºæ­Œå‰§...
å­—æ•°: 314

================================================================================
ğŸ“‹ é˜¶æ®µ 2: ç”Ÿæˆå°è¯´å¤§çº²
================================================================================
âœ“ å¤§çº²ç”Ÿæˆå®Œæˆ
å­—æ•°: 650

================================================================================
ğŸ‘¥ é˜¶æ®µ 3: ç”Ÿæˆäººç‰©è®¾å®š
================================================================================
âœ“ äººç‰©è®¾å®šå®Œæˆ
å­—æ•°: 480

================================================================================
ğŸ“– é˜¶æ®µ 4.1: ç”Ÿæˆç¬¬ 1 ç« 
================================================================================
âœ“ ç¬¬ 1 ç« ç”Ÿæˆå®Œæˆ
å­—æ•°: 820
è´¨é‡è¯„åˆ†: 0.82
å½“å‰æ€»å­—æ•°: 820 / 4000

[...ç»§ç»­ç”Ÿæˆç« èŠ‚...]

================================================================================
ğŸ¯ é˜¶æ®µ 5: æœ€ç»ˆè´¨é‡è¯„ä¼°
================================================================================
æ€»å­—æ•°: 4200
æ•´ä½“è´¨é‡è¯„åˆ†: 0.780

ç»´åº¦è¯„åˆ†:
  - coherence: 0.850
  - creativity: 0.780
  - quality: 0.750
  - consistency: 0.820
  - plot_progression: 0.700

================================================================================
ğŸ“Š éªŒæ”¶æ ‡å‡†æ£€æŸ¥
================================================================================

âœ… é€šè¿‡çš„æ ‡å‡†:
  âœ“ å­—æ•°è¾¾æ ‡: 4200 â‰¥ 4000
  âœ“ æ•´ä½“è´¨é‡è¾¾æ ‡: 0.780 â‰¥ 0.7
  âœ“ æ‰€æœ‰ç»´åº¦è¯„åˆ† â‰¥ 0.6

================================================================================
ğŸ æµ‹è¯•å®Œæˆ
================================================================================
æ€»è€—æ—¶: 420.15 ç§’
æ€»å­—æ•°: 4200
ç« èŠ‚æ•°: 5
æµ‹è¯•ç»“æœ: âœ… é€šè¿‡
================================================================================
```

### å¸¸è§é—®é¢˜

#### Q: æµ‹è¯•å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ

A: æ£€æŸ¥ `test_results/test_report_[æ—¶é—´æˆ³].json` ä¸­çš„ `acceptance_criteria.failed` å­—æ®µï¼Œäº†è§£æœªé€šè¿‡çš„å…·ä½“é¡¹ç›®ï¼š

- **å­—æ•°ä¸è¶³**: å¯èƒ½æ˜¯ç« èŠ‚ç”Ÿæˆå­—æ•°åå°‘ï¼Œæ£€æŸ¥ LLM å‚æ•°
- **è´¨é‡è¯„åˆ†ä½**: æŸ¥çœ‹å…·ä½“å“ªä¸ªç»´åº¦è¯„åˆ†ä½ï¼Œé’ˆå¯¹æ€§ä¼˜åŒ–æç¤ºè¯
- **æŸç« èŠ‚å¤±è´¥**: æŸ¥çœ‹ errors æ•°ç»„ä¸­çš„å…·ä½“é”™è¯¯ä¿¡æ¯

#### Q: å¦‚ä½•è°ƒæ•´æµ‹è¯•å‚æ•°ï¼Ÿ

A: ä¿®æ”¹ `test_scifi_novel.py` ä¸­çš„ `TEST_CONFIG`:

```python
TEST_CONFIG = {
    "genre": "ç§‘å¹»",          # å¯æ”¹ä¸ºï¼šç„å¹»ã€æ­¦ä¾ ã€éƒ½å¸‚ç­‰
    "target_words": 4000,     # ç›®æ ‡æ€»å­—æ•°
    "min_quality_score": 0.7, # æœ€ä½è´¨é‡è¦æ±‚
    "min_dimension_score": 0.6, # æœ€ä½ç»´åº¦è¦æ±‚
    "chapter_word_count": 800, # æ¯ç« å­—æ•°
}
```

#### Q: æµ‹è¯•è€—æ—¶å¤ªé•¿ï¼Ÿ

A: å¯ä»¥å‡å°‘ç›®æ ‡å­—æ•°è¿›è¡Œå¿«é€Ÿæµ‹è¯•ï¼š

```python
TEST_CONFIG = {
    ...
    "target_words": 2000,  # å‡å°‘åˆ° 2000 å­—
    "chapter_word_count": 500,  # æ¯ç«  500 å­—
}
```

#### Q: å¦‚ä½•åªæµ‹è¯•æŸä¸ªé˜¶æ®µï¼Ÿ

A: æ³¨é‡Šæ‰ `run()` æ–¹æ³•ä¸­ä¸éœ€è¦çš„é˜¶æ®µï¼š

```python
async def run(self):
    await self.initialize()
    await self.generate_style()
    await self.generate_outline()
    # await self.generate_characters()  # è·³è¿‡äººç‰©è®¾å®š
    # await self.generate_all_chapters()  # è·³è¿‡ç« èŠ‚ç”Ÿæˆ
    # await self.final_evaluation()  # è·³è¿‡æœ€ç»ˆè¯„ä¼°
```

### æ‰©å±•æµ‹è¯•

å¯ä»¥åŸºäºæ­¤æµ‹è¯•åˆ›å»ºå…¶ä»–ç±»å‹çš„æµ‹è¯•ï¼š

1. **ç„å¹»å°è¯´æµ‹è¯•**: ä¿®æ”¹ genre ä¸º"ç„å¹»"
2. **é•¿ç¯‡æµ‹è¯•**: å¢åŠ  target_words åˆ° 10000+
3. **å¤šç« èŠ‚æµ‹è¯•**: è°ƒæ•´æ¯ç« å­—æ•°å’Œæ€»å­—æ•°
4. **å‹åŠ›æµ‹è¯•**: è¿ç»­è¿è¡Œå¤šæ¬¡æµ‹è¯•

### æŠ€æœ¯ç»†èŠ‚

#### LLM è·¯ç”±ç­–ç•¥

æµ‹è¯•ä½¿ç”¨ MultiLLMClient è‡ªåŠ¨è·¯ç”±ä¸åŒä»»åŠ¡åˆ°æœ€é€‚åˆçš„æ¨¡å‹ï¼š

- **å¤§çº²**: Qwen (æ“…é•¿ç»“æ„åŒ–æ€è€ƒ)
- **ç« èŠ‚å†…å®¹**: DeepSeek (åˆ›ä½œèƒ½åŠ›å¼º)
- **äººç‰©è®¾è®¡**: Qwen (è®¾å®šç”Ÿæˆ)
- **é£æ ¼å…ƒç´ **: Qwen (æ¦‚å¿µæç‚¼)

#### å‘é‡å­˜å‚¨

æ‰€æœ‰ç”Ÿæˆçš„å†…å®¹éƒ½å­˜å‚¨åœ¨ ChromaDB å‘é‡æ•°æ®åº“ä¸­ï¼Œæ”¯æŒè¯­ä¹‰æœç´¢å’Œä¸Šä¸‹æ–‡æ£€ç´¢ã€‚

#### è´¨é‡è¯„ä¼°

ä½¿ç”¨ LLM è¿›è¡Œå¤šç»´åº¦è´¨é‡è¯„ä¼°ï¼Œç»“åˆï¼š
- è¯­ä¹‰ä¸€è‡´æ€§æ£€æŸ¥
- åˆ›æ–°æ€§è¯„åˆ†
- å†™ä½œè´¨é‡è¯„åˆ†
- ç›®æ ‡å¯¹é½åº¦

### è´¡çŒ®

å¦‚æœå‘ç°æµ‹è¯•ä¸­çš„é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œæ¬¢è¿æäº¤ Issue æˆ– Pull Requestã€‚
