# 前端功能与技术文档（可视化分步小说生成）

## 1. 目标与范围
- 目标：把小说生成流程「可视化、可追踪、可回放」，让用户一步一步执行，最终查看每一章的完整结果，并支持导出。
- 范围：前端展示、交互流程、与后端接口协同、状态管理与可视化方案。

## 2. 关键用户流程（端到端）
1. 选择风格与参数
   - 输入：主题/风格、章节数、每章场景数、总字数目标
   - 输出：创建一个“生成会话”（Session）
2. 生成计划（Pipeline）
   - 展示系统生成的任务链（如：风格→大纲→事件→人物→…→章节）
   - 用户可查看每一步的目标与依赖
3. 逐步执行
   - 一步一执行（手动点“下一步”）或自动播放（可暂停）
   - 每步显示：Prompt摘要、结果预览、评估/审计信息
4. 章节结果
   - 按章节展示最终润色内容
   - 支持章节对比、历史版本回放
5. 导出
   - 生成并下载 txt / markdown

## 3. 核心功能清单
### 3.1 会话管理
- 新建会话（Session）
- 会话列表/历史记录
- 进度恢复（断点续跑）

### 3.2 流程可视化
- 流程图/时间线视图
- 任务状态：未开始/进行中/完成/失败/重试
- 依赖关系展示

### 3.3 步骤执行与回放
- 单步执行
- 自动播放
- 暂停/继续
- 失败重试
- 步骤详细日志

### 3.4 内容可视化
- 每一步结果卡片
- 章节内容分章展示
- 章节历史版本（润色前/后）

### 3.5 评估与审计
- 评分结果展示
- 不通过原因展示
- 通过/不通过统计

### 3.6 导出与分享
- 导出 txt/markdown
- 章节单独导出
- 会话链接分享（可选）

## 4. 推荐前端技术栈
### 4.1 基础技术
- 框架：React + TypeScript
- 构建：Vite
- 状态管理：Zustand（轻量）或 Redux Toolkit（复杂状态）
- 路由：React Router

### 4.2 UI 与可视化
- UI组件库：Ant Design / Arco Design / Mantine（三选一）
- 流程图：React Flow（任务链/依赖图）
- 时间线：AntD Timeline / 自定义组件
- Markdown渲染：react-markdown

### 4.3 数据层
- 请求：axios
- 缓存：TanStack Query（可选）
- WebSocket：用于实时进度更新

### 4.4 导出
- 文件导出：FileSaver.js
- txt/markdown 生成：前端拼接内容

## 5. 页面结构建议
### 5.1 首页（会话列表）
- 新建会话
- 历史会话列表

### 5.2 生成配置页
- 参数配置表单（风格、字数、章节等）
- 确认创建

### 5.3 流程可视化页（核心）
- 左侧：流程图/任务列表
- 中间：步骤详情 + 输出预览
- 右侧：评估/审计面板
- 顶部：执行控制（下一步/自动/暂停）

### 5.4 章节结果页
- 章节卡片列表
- 点击进入章节详情

### 5.5 导出页
- 导出设置
- 下载按钮

## 6. 前后端接口需求（示例）
### 6.1 会话
- POST /api/sessions  创建会话
- GET /api/sessions   查询会话列表
- GET /api/sessions/:id  获取会话详情

### 6.2 流程与任务
- GET /api/sessions/:id/steps
- POST /api/sessions/:id/step/next
- POST /api/sessions/:id/step/retry

### 6.3 章节内容
- GET /api/sessions/:id/chapters
- GET /api/sessions/:id/chapters/:chapterId

### 6.4 导出
- GET /api/sessions/:id/export?format=txt

### 6.5 实时状态
- WS /api/sessions/:id/stream

## 7. 状态设计（前端）
- session: 当前会话
- steps: 任务列表与状态
- currentStep: 当前执行步骤
- results: 步骤结果缓存
- chapters: 章节内容
- audit: 评估结果

## 8. 关键交互细节
- 步骤详情支持折叠/展开
- 支持快速定位“失败步骤”
- 章节内容提供复制按钮
- 导出前预览合并文本

## 9. 性能与体验
- 步骤结果分页加载
- 大文本懒加载
- WebSocket 断线重连

## 10. 里程碑建议
1. MVP：会话创建 + 步骤列表 + 单步执行 + 章节展示
2. 可视化：流程图 + 时间线 + 实时状态
3. 完整版：历史回放 + 导出 + 分享
